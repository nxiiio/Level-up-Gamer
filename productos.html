<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Productos - Level-Up</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
  <nav>
    <a href="index.html" class="logo">Level-Up</a>
    <ul class="nav-links">
      <li><a href="index.html#inicio">Inicio</a></li>
      <li><a href="index.html#productos">Productos</a></li>
      <li><a href="contacto.html">Contacto</a></li>
    </ul>
    <div id="auth-buttons"></div>
  </nav>
</header>

<section class="products-section">
  <div class="container">
    <h2 class="section-title">CatÃ¡logo</h2>
    <div class="filters" id="filters"></div>
    <div class="products-grid" id="grid"></div>
  </div>
</section>

<footer>
  <div class="container">
    <div class="footer-bottom">
      <p>&copy; 2025 Level-Up. Todos los derechos reservados.</p>
    </div>
  </div>
</footer>

<script src="auth.js"></script>
<script src="products.js"></script>
<script>
document.addEventListener("DOMContentLoaded", ()=>{
  const authDiv = document.getElementById('auth-buttons');
  const u = window.GZAuth.currentUser();
  if(u){
    authDiv.innerHTML = `<button class="cart-btn" onclick="location.href='carrito.html'">ðŸ›’ Carrito</button><button class="btn-secondary" id="logout">Salir</button>`;
    document.getElementById('logout').onclick = ()=>{ GZAuth.logout(); location.reload(); };
  }else{
    authDiv.innerHTML = `<button class="cart-btn" onclick="location.href='login.html'">Iniciar sesiÃ³n</button><button class="btn-secondary" onclick="location.href='register.html'">Registrarse</button>`;
  }

  const filtersDiv = document.getElementById('filters');
  const grid = document.getElementById('grid');
  let active = 'all';

  function drawFilters(){
    filtersDiv.innerHTML = '';
    const allBtn = document.createElement('button');
    allBtn.className = 'filter-btn' + (active==='all'?' active':'');
    allBtn.textContent = 'Todos';
    allBtn.onclick = ()=>{active='all'; drawFilters(); drawGrid();};
    filtersDiv.appendChild(allBtn);
    GZProducts.categories().forEach(c=>{
      const b = document.createElement('button');
      b.className = 'filter-btn' + (active===c.id?' active':'');
      b.textContent = c.name;
      b.onclick = ()=>{active=c.id; drawFilters(); drawGrid();};
      filtersDiv.appendChild(b);
    });
  }

  function priceWithDiscount(p){
    return u && u.email.endsWith('@duocuc.cl') ? Math.round(p*0.8) : p;
  }

  function drawGrid(){
    const data = GZProducts.list().filter(p=> active==='all' || p.cat===active);
    grid.innerHTML = '';
    data.forEach(p=>{
      const card = document.createElement('div');
      card.className = 'product-card';
      card.innerHTML = `
        <div class="product-image">ðŸŽ®</div>
        <div class="product-info">
          <div class="product-title"><a href="producto.html?code=${p.code}" style="color:#fff;text-decoration:none">${p.name}</a></div>
          <div class="product-description">${p.desc}</div>
          <div class="product-price">${new Intl.NumberFormat('es-CL',{style:'currency',currency:'CLP'}).format(priceWithDiscount(p.price))}</div>
          <button class="add-to-cart">Agregar al carrito</button>
        </div>`;
      card.querySelector('.add-to-cart').onclick = ()=>{
        const cart = JSON.parse(localStorage.getItem('gz_cart')||'[]');
        const existing = cart.find(i=>i.code===p.code);
        if(existing){ existing.qty += 1; } else { cart.push({code:p.code, name:p.name, price:priceWithDiscount(p.price), qty:1}); }
        localStorage.setItem('gz_cart', JSON.stringify(cart));
        alert('AÃ±adido al carrito');
      };
      grid.appendChild(card);
    });
  }

  drawFilters();
  drawGrid();
});
</script>
</body>
</html>